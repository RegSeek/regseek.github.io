title: "WDigest Plaintext Credential Caching"
category: "authentication"
description: "WDigest authentication provider configuration controlling plaintext credential storage in LSASS memory for credential harvesting"

paths:
  - "HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest"

details:
  what: |
    WDigest Security Support Provider (SSP) configuration that controls whether plaintext passwords
    are cached in Local Security Authority Subsystem Service (LSASS) memory. When UseLogonCredential
    is set to 1, Windows stores plaintext credentials in memory to support legacy HTTP Digest
    authentication, making credentials vulnerable to memory dumping attacks like Mimikatz.

  forensic_value: |
    Indicator of credential theft preparation. Attackers enable WDigest caching to harvest
    plaintext passwords from LSASS memory dumps. Finding UseLogonCredential=1 is a strong indicator
    of advanced persistent threat (APT) activity, credential harvesting operations, or post-exploitation
    lateral movement preparation. This technique is documented in MITRE ATT&CK T1003.001.

  structure: |
    Registry key contains UseLogonCredential DWORD value:
    - 0 or absent: Plaintext credentials NOT cached (secure default in Windows 8.1+)
    - 1: Plaintext credentials cached in LSASS memory (vulnerable to Mimikatz)
    Additional values may include Negotiate, LogonDomainMaxLength configuration.

  examples:
    - "UseLogonCredential: 1 (plaintext credential caching ENABLED)"
    - "UseLogonCredential: 0 (plaintext caching disabled)"
    - "Value absent: Default secure behavior (Windows 8.1+)"
    - "Negotiate: wdigest (authentication protocol configuration)"

  tools:
    - name: "Mimikatz"
      url: "https://github.com/gentilkiwi/mimikatz"
      description: "Credential extraction tool that harvests WDigest cached credentials"
    - name: "Registry Explorer"
      url: "https://ericzimmerman.github.io/#!index.md"
      description: "Advanced registry browser for WDigest configuration analysis"
    - name: "Process Hacker"
      url: "https://processhacker.sourceforge.io/"
      description: "Memory analysis tool for LSASS credential detection"
    - name: "CrackMapExec"
      url: "https://github.com/byt3bl33d3r/CrackMapExec"
      description: "Post-exploitation tool that checks for WDigest credential availability"
    - name: "Sysinternals ProcDump"
      url: "https://learn.microsoft.com/en-us/sysinternals/downloads/procdump"
      description: "LSASS memory dumping for offline credential extraction"

limitations:
  - "WDigest enablement does NOT prove credentials were actually harvested"
  - "UseLogonCredential=1 doesn't indicate successful memory dumping occurred"
  - "Configuration change doesn't show who made the modification or when credentials were accessed"
  - "Setting may be enabled for legitimate legacy application compatibility"
  - "Registry value doesn't reveal which credentials are cached or accessed"
  - "Modification timestamp can be altered to hide attack timeline"
  - "Protected Process Light (PPL) for LSASS may prevent memory dumping despite this setting"

correlation:
  required_for_definitive_credential_theft_proof:
    - "Security Event Logs showing LSASS process access (Event ID 4656, 4663)"
    - "Process execution logs showing Mimikatz or credential dumping tools"
    - "Network traffic logs showing lateral movement with harvested credentials"
    - "Memory dumps containing extracted plaintext credentials"
    - "File system artifacts showing credential dump files or output"

  strengthens_evidence:
    - "LSA Protection (RunAsPPL) disabled in same timeframe"
    - "Registry Run Keys or persistence mechanisms for credential harvesters"
    - "Remote Desktop or WMI connections following credential access"
    - "Suspicious PowerShell execution with memory access cmdlets"
    - "Scheduled tasks running credential harvesting scripts"
    - "Event log clearing or security audit policy modifications"

metadata:
  windows_versions:
    - "Windows 7"
    - "Windows 8"
    - "Windows 8.1"
    - "Windows 10"
    - "Windows 11"
    - "Windows Server 2008"
    - "Windows Server 2008 R2"
    - "Windows Server 2012"
    - "Windows Server 2012 R2"
    - "Windows Server 2016"
    - "Windows Server 2019"
    - "Windows Server 2022"

  introduced: "Windows 2000 (WDigest SSP), Windows 7 (exploitation technique)"
  criticality: "high"

  investigation_types:
    - "incident-response"
    - "credential-theft"
    - "malware-analysis"
    - "persistence-analysis"
    - "privilege-escalation"
    - "lateral-movement"

  tags:
    - "credential-theft"
    - "wdigest"
    - "lsass"
    - "mimikatz"
    - "memory-dumping"
    - "plaintext-passwords"
    - "authentication-attack"
    - "post-exploitation"
    - "apt-indicator"

  references:
    - title: "MITRE ATT&CK: OS Credential Dumping - LSASS Memory"
      url: "https://attack.mitre.org/techniques/T1003/001/"
      type: "research"
    - title: "Microsoft: Mitigating Pass-the-Hash and Other Credential Theft"
      url: "https://learn.microsoft.com/en-us/windows/security/identity-protection/credential-guard/credential-guard"
      type: "official"
    - title: "Preventing Mimikatz Attacks"
      url: "https://www.microsoft.com/en-us/security/blog/2022/10/05/detecting-and-preventing-lsass-credential-dumping-attacks/"
      type: "official"
    - title: "WDigest Authentication Protocol"
      url: "https://learn.microsoft.com/en-us/windows/win32/secauthn/microsoft-digest-ssp"
      type: "official"
    - title: "Hunting for Credential Dumping"
      url: "https://www.sans.org/blog/hunting-for-credential-dumping/"
      type: "research"

  retention:
    default_location: "SYSTEM registry hive"
    persistence: "Survives reboots until explicitly modified, highly persistent attack indicator"
    volatility: "Configuration persists indefinitely, requires system-level privileges to modify"

  related_artifacts:
    - "lsa_security_packages"
    - "credential_providers"
    - "registry_run_keys"
    - "scheduled_tasks"
    - "powershell_execution_policy"
    - "windows_defender_security"
    - "event_log_config"

author:
  name: "Tonmoy Jitu"
  github: "tonmoy0010"
  x: "tonmoy0010"

contribution:
  date_added: "2025-11-03"
  last_updated: "2025-11-03"
  version: "1.0"
