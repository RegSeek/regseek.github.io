title: "AppCertDLLs DLL Injection Persistence"
category: "persistence"
description: "Application Certification DLL injection mechanism for persistent code execution in all processes"

paths:
  - "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\AppCertDLLs"

details:
  what: |
    AppCertDLLs registry key enables system-wide DLL injection by specifying Dynamic Link Libraries
    that Windows automatically loads into every process that calls CreateProcess, CreateProcessAsUser,
    CreateProcessWithLogonW, CreateProcessWithTokenW, and WinExec APIs. Originally designed for
    application certification and compatibility testing, this mechanism provides powerful process
    injection capabilities for both legitimate and malicious purposes.

  forensic_value: |
    Critical persistence mechanism used by advanced malware and sophisticated attackers for system-wide
    code injection. Shows evidence of persistent DLL injection affecting all processes, rootkit-like
    behavior, and advanced evasion techniques. Extremely dangerous when abused as it provides
    unrestricted access to all process memory spaces and can be used for credential theft, process
    manipulation, and comprehensive system compromise. Essential for detecting advanced persistent threats.

  structure: |
    Registry key contains value names as arbitrary identifiers with REG_SZ data specifying full
    paths to DLL files. Each DLL listed will be automatically injected into every new process
    created on the system. Multiple DLLs can be specified with different value names. Empty
    or non-existent key is normal; any entries should be investigated as potential malware.

  examples:
    - "CertificationDLL1: C:\\Windows\\System32\\legitimate_cert.dll (Legitimate certification DLL)"
    - "MaliciousDLL: C:\\malware\\backdoor.dll (Suspicious DLL injection)"
    - "RootkitDLL: C:\\Windows\\System32\\evil_rootkit.dll (Rootkit persistence)"
    - "SpywareDLL: C:\\temp\\keylogger.dll (Keylogging DLL injection)"
    - "Empty Key: (Normal state - no DLL injection configured)"

  tools:
    - name: "Registry Explorer"
      url: "https://ericzimmerman.github.io/#!index.md"
      description: "Advanced registry analysis for AppCertDLLs detection"
    - name: "Autoruns"
      url: "https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns"
      description: "Microsoft Sysinternals tool with AppCertDLLs enumeration"
    - name: "Process Monitor"
      url: "https://docs.microsoft.com/en-us/sysinternals/downloads/procmon"
      description: "Real-time monitoring of DLL injection activities"
    - name: "RegRipper"
      url: "https://github.com/keydet89/RegRipper3.0"
      description: "Registry analysis with persistence mechanism detection"
    - name: "DLL Injection Detectors"
      description: "Specialized security tools for detecting DLL injection techniques"

metadata:
  windows_versions:
    - "Windows NT"
    - "Windows 2000"
    - "Windows XP"
    - "Windows Vista"
    - "Windows 7"
    - "Windows 8"
    - "Windows 8.1"
    - "Windows 10"
    - "Windows 11"
    - "Windows Server 2000"
    - "Windows Server 2003"
    - "Windows Server 2008"
    - "Windows Server 2012"
    - "Windows Server 2016"
    - "Windows Server 2019"
    - "Windows Server 2022"

  introduced: "Windows NT"

  criticality: "high"

  investigation_types:
    - "malware-analysis"
    - "persistence-analysis"
    - "privilege-escalation"
    - "incident-response"
    - "behavioral-analysis"

  tags:
    - "persistence"
    - "dll-injection"
    - "process-injection"
    - "system-wide-injection"
    - "advanced-malware"
    - "rootkits"
    - "appcertdlls"
    - "code-injection"
    - "sophisticated-attacks"

  references:
    - title: "Microsoft Documentation: Application Certification"
      url: "https://docs.microsoft.com/en-us/windows/win32/win7appqual/application-certification"
      type: "official"
    - title: "MITRE ATT&CK: Process Injection"
      url: "https://attack.mitre.org/techniques/T1055/"
      type: "research"
    - title: "AppCertDLLs Persistence Technique Analysis"
      url: "https://www.sans.org/blog/appcertdlls-persistence-technique/"
      type: "research"
    - title: "DLL Injection Techniques and Detection"
      url: "https://www.elastic.co/blog/ten-process-injection-techniques-technical-survey-common-and-trending-process"
      type: "research"

  retention:
    default_location: "SYSTEM registry hive"
    persistence: "Survives reboots, affects all future process creation until removed"
    volatility: "Extremely persistent mechanism affecting entire system until explicit removal"

  related_artifacts:
    - "lsa_packages"
    - "winlogon_userinit"
    - "image_hijack"
    - "com_objects"
    - "services"

author:
  name: "Tonmoy Jitu"
  github: "tonmoy0010"
  x: "tonmoy0010"

contribution:
  date_added: "2025-01-15"
  last_updated: "2025-01-15"
  version: "1.0"